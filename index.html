<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Riverford Data Analytics</title>
        <link rel="stylesheet" href="css/style.css">
        <script src="js/Chart.bundle.js"></script>
        <style type="text/css">
            /* Chart.js */
            @-webkit-keyframes chartjs-render-animation {
                from {
                    opacity: 0.99
                }
                to {
                    opacity: 1
                }
            }

            @keyframes chartjs-render-animation {
                from {
                    opacity: 0.99
                }
                to {
                    opacity: 1
                }
            }

            .chartjs-render-monitor {
                -webkit-animation: chartjs-render-animation 0.001s;
                animation: chartjs-render-animation 0.001s;
            }
        </style>
    </head>
    <body>
        <h1>Riverford Data Analytics</h1>
		*The total sales of each categorized group of produce sold by Riverford Organic Farms
		<br></br>
        <canvas id="TotalsChart"></canvas>
		<canvas id="ProduceChart"></canvas>
        <script>
		
            // Initial data load
            fetch("https://api.myjson.com/bins/fa68h", {
                method: "GET",
                headers: new Headers({
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                })
            }).then(function (body) {
                return body.json();
            }).then(function (data) {
				
				var chartData = new Array();
				var chartLabels = new Array();
				var chartColours = new Array();
				var chartBorderColours = new Array();
				
				for (var key in data)
				{
					chartData.push(GetTotalProduce(data[key]));
					chartLabels.push(key);
					
					var redValue = Math.floor((Math.random() * 256));
					var greenValue = Math.floor((Math.random() * 256));
					var blueValue = Math.floor((Math.random() * 256));
					
					chartColours.push("rgba(" + redValue + "," + greenValue + "," + blueValue + ",0.6)");
					chartBorderColours.push("rgba(" + redValue + "," + greenValue + "," + blueValue + ",1)");
				}
				
				var totalsChart = new Chart(document.getElementById("TotalsChart").getContext('2d'), 
				{
					type: 'bar',
					data: 
					{
						labels: chartLabels,
						datasets: 
						[{
							label: 'Riverford Produce Sales',
							data: chartData,
							backgroundColor: chartColours,
							borderColor: chartBorderColours,
							borderWidth: 1
						}]
					},
					option:
					{
						animation:
						{
							duration: 1000,
						},
						legend:
						{
							display: false,
						},
					}
				});
            });
			
			function GetTopTen(array)
			{
				var topTen = {};
				
				for (var key in array)
				{
					if (Object.keys(topTen).length < 10)
						topTen[key] = array[key];
					else
					{
						var lowestKey = FindLowestKey(topTen);
						
						if (array[key] > topTen[lowestKey])
						{
							delete topTen[lowestKey];
							topTen[key] = array[key];
						}
					}
				}
				
				return topTen;
			};
			
			function FindLowestKey(array)
			{
				var lowestKey;
				
				for (var key in array)
				{
					if (lowestKey != null)
					{
						if (array[lowestKey] > array[key])
							lowestKey = key;
					}
					else
						lowestKey = key;
				}
				
				return lowestKey;
			};
			
			function SortArray(array)
			{
				var sortedArray = {};
				
				while (Object.keys(array).length > 0)
				{
					var largestKey = null;
				
					for (var key in array)
					{
						if (largestKey == null)
							largestKey = key;
						else
						{
							if (array[largestKey] < array[key])
								largestKey = key;
						}
					}
					
					sortedArray[largestKey] = array[largestKey];
					delete array[largestKey];
				}
				
				return sortedArray;
			};
			
			function GetTotalProduce(array)
			{
				var total = 0;
				
				for (var key in array)
					total += array[key];
				
				return total;
			};
			
        </script>
    </body>
</html>
